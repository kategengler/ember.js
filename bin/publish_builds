#!/usr/bin/env bash

# ensure the first failure, stops the script
set -e

echo -e "TRAVIS_BRANCH: ${TRAVIS_BRANCH}\n"
echo -e "TRAVIS_COMMIT: ${TRAVIS_COMMIT}\n"
echo -e "TRAVIS_TAG: ${TRAVIS_TAG}\n"
echo -e "PULL_REQUEST: ${TRAVIS_PULL_REQUEST}\n"

if [ "$TRAVIS_PULL_REQUEST" == "false" ] && [ "$PUBLISH" == "true" ]; then

  node ./bin/build-for-publishing.js

  node ./bin/publish_to_s3.js

  #### NPM PUBLISHING
  if [[ "$TRAVIS_TAG" =~ ^v[0-9.]+ ]]; then
    echo -e "CURRENT_TAG: ${TRAVIS_TAG}\n"
  fi
fi
