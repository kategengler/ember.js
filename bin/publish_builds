#!/usr/bin/env bash

# ensure the first failure, stops the script
set -e

GITHUB_BRANCH=${GITHUB_REF##*/}
echo -e "CURRENT_BRANCH: ${GITHUB_BRANCH}\n"

#### TODO UNCOMMENT
#node ./bin/build-for-publishing.js

#### TODO UNCOMMENT
#node ./bin/publish_to_s3.js

#### NPM PUBLISHING
if [[ "$GITHUB_BRANCH" =~ ^v[0-9.]+ ]]; then
  echo -e "CURRENT_TAG: ${GITHUB_BRANCH}\n"
  #### TODO UNCOMMENT
  #echo "//registry.npmjs.org/:_authToken=${NPM_AUTH_TOKEN}"> ~/.npmrc

  #NPM_USER=$(npm whoami)
  #echo -e "Publishing to npm as $NPM_USER...\n"

  # auto-dist-tag is ran by bin/build-for-publishing.js
  # this ensures that the `publishConfig` object in the `package.json`
  # indicates the correct tag to be published
#### TODO UNCOMMENT
#### npm publish
fi
